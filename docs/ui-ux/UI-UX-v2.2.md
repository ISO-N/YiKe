# 忆刻 (YiKe) UI/UX v2.2 - 主题功能升级设计稿

## 概述

本文档定义忆刻 v2.2 版本的主题功能升级设计，包括深色主题、跟随系统主题、主题设置入口的界面设计。

---

## 一、设计系统

### 1.1 基础规范

| 属性 | 值 |
|------|-----|
| **主色调** | #0D9488 (Teal 600) |
| **次要色** | #14B8A6 (Teal 500) |
| **CTA 色** | #F97316 (Orange 500) |
| **字体** | Inter |
| **圆角** | 12px |
| **阴影** | 柔和投影 (0 4px 12px rgba(0,0,0,0.08)) |

> **字体说明**：若项目未引入 Inter 字体资源，则以系统默认字体（Roboto/SF Pro）为准，无需额外接入。TDD 无字体配置任务。

### 1.2 浅色模式配色

| 元素 | 颜色值 | 说明 |
|------|--------|------|
| 背景色 | #F0FDFA | Teal 50 |
| 表面色 | #FFFFFF | 纯白 |
| 文字主色 | #0F172A | Slate 900 |
| 文字次色 | #64748B | Slate 500 |
| 毛玻璃底色 | rgba(255,255,255,0.80) | 80% 不透明 |
| 毛玻璃边框 | rgba(255,255,255,0.40) | 40% 不透明 |
| 分割线 | #E2E8F0 | Slate 200 |

### 1.3 深色模式配色 (OLED Optimized)

| 元素 | 颜色值 | 说明 |
|------|--------|------|
| 背景色 | #1A1A2E | 深蓝黑 |
| 表面色 | #16213E | 深蓝 |
| 文字主色 | #F1F5F9 | Slate 100 |
| 文字次色 | #94A3B8 | Slate 400 |
| 毛玻璃底色 | rgba(22,33,62,0.80) | 80% 不透明 |
| 毛玻璃边框 | rgba(255,255,255,0.10) | 10% 不透明 |
| 分割线 | rgba(255,255,255,0.10) | 10% 不透明 |
| 激活项高亮 | #14B8A6 | Teal 500 |

### 1.4 状态颜色（深浅通用）

| 状态 | 颜色值 |
|------|--------|
| 成功 | #22C55E |
| 警告 | #F59E0B |
| 错误 | #EF4444 |
| 信息 | #3B82F6 |

---

## 二、深色主题设计

### 2.1 首页（深色）

```
┌─────────────────────────────────┐
│  📅 2月26日  周三        ⚙️    │  ← 背景 #1A1A2E，文字 #F1F5F9
├─────────────────────────────────┤
│                                 │
│  ┌───────────────────────────┐  │
│  │ 🔔 今日待复习             │  │  ← 卡片背景 #16213E
│  │           3/5 已完成      │  │     圆角 12px
│  └───────────────────────────┘  │
│                                 │
│  ┌───────────────────────────┐  │
│  │ ☐ Java 集合框架          │  │  ← 任务项
│  │    第 2 次复习 · 标签     │  │
│  ├───────────────────────────┤  │
│  │ ☑ Spring IoC 原理        │  │  ← 已完成项使用
│  │    第 1 次复习            │  │    成功色 #22C55E
│  └───────────────────────────┘  │
│                                 │
└─────────────────────────────────┘
           ↑ 底部导航 ↑            ← 背景 #16213E
```

### 2.2 录入页（深色）

```
┌─────────────────────────────────┐
│  ← 新增学习内容                 │  ← 文字 #F1F5F9
├─────────────────────────────────┤
│                                 │
│  标题 *                         │
│  ┌───────────────────────────┐  │
│  │ 输入今天学习的内容...      │  │  ← 输入框背景 #16213E
│  └───────────────────────────┘  │     边框 rgba(255,255,255,0.10)
│                                 │
│  备注（选填）                   │
│  ┌───────────────────────────┐  │
│  │                           │  │
│  │                           │  │
│  └───────────────────────────┘  │
│                                 │
│  标签                           │
│  ┌─────┐ ┌─────┐ ┌─────┐      │
│  │Java│ │Flutter│ │英语│      │  ← 标签_chip 背景
│  └─────┘ └─────┘ └─────┘         #14B8A6/20%
│                                 │
│                                 │
│  ┌───────────────────────────┐  │
│  │       确认录入            │  │  ← CTA 按钮 #F97316
│  └───────────────────────────┘  │
│                                 │
└─────────────────────────────────┘
```

### 2.3 日历视图（深色）

```
┌─────────────────────────────────┐
│     ◀  2026年2月  ▶            │  ← 文字 #F1F5F9
├─────────────────────────────────┤
│  一   二   三   四   五   六   日 │
│              1    2    3    4   │
│   5    6    7    8    9   10  11   │
│  12   13   14●  15   16   17  18   │  ← ● 表示有任务
│  19   20   21   22   23   24  25   │    颜色根据状态变化
│  26   27   28                      │
│                                 │
├─────────────────────────────────┤
│  2月14日 周五                   │
│  ┌───────────────────────────┐  │
│  │ ● Java 集合框架          │  │  ← 逾期标记警告色
│  │   第 3 次复习            │  │    #F59E0B
│  ├───────────────────────────┤  │
│  │ ● Spring IoC 原理        │  │
│  │   第 1 次复习            │  │
│  └───────────────────────────┘  │
└─────────────────────────────────┘
```

### 2.4 统计页（深色）

```
┌─────────────────────────────────┐
│  学习统计                       │
├─────────────────────────────────┤
│                                 │
│  ┌───────────────────────────┐  │
│  │    🔥 连续打卡            │  │
│  │         12 天            │  │  ← 数字使用主色调 #14B8A6
│  └───────────────────────────┘  │
│                                 │
│  ┌──────────┐ ┌──────────┐      │
│  │本周完成率│ │本月完成率│      │
│  │   85%   │ │   72%   │      │  ← 环形进度条
│  └──────────┘ └──────────┘      │
│                                 │
│  ┌───────────────────────────┐  │
│  │    📊 标签分布            │  │
│  │                         │  │
│  │  Java    ████████ 40%   │  │
│  │  Flutter █████   25%    │  │
│  │  英语    ████    20%    │  │
│  │  其他    ███     15%    │  │
│  └───────────────────────────┘  │
│                                 │
└─────────────────────────────────┘
```

---

## 三、主题设置入口设计

### 3.1 设置页面布局

```
┌─────────────────────────────────┐
│           设置                  │  ← 页面标题
├─────────────────────────────────┤
│                                 │
│  提醒设置                       │
│  ├─ 每日提醒          09:00   │  → 点击跳转
│  └─ 免打扰时段        22:00-07:00
│                                 │
│  复习设置                       │
│  ├─ 复习间隔          默认     │
│  └─ 复习提醒          已开启   │
│                                 │
│  外观设置               ← 新增分组
│  ├─ 主题模式          跟随系统 │  → 点击弹出底部Sheet
│  │
│  数据管理                       │
│  ├─ 数据导出          JSON     │
│  └─ 数据备份          本地     │
│                                 │
│  关于                           │
│  ├─ 版本号            v2.2.0   │
│  └─ 评价我们          →        │
│                                 │
└─────────────────────────────────┘
```

### 3.2 主题模式选择（底部 Sheet）

```
┌─────────────────────────────────┐
│            ─────                │  ← 拖拽手柄
│                                 │
│  选择主题模式                   │
│                                 │
│  ┌───────────────────────────┐  │
│  │ ○  跟随系统              │  │  ← 默认选项
│  │    自动跟随手机设置      │  │
│  ├───────────────────────────┤  │
│  │ ●  浅色                  │  │  ← 当前选中
│  │    明亮模式              │  │
│  ├───────────────────────────┤  │
│  │ ○  深色                  │  │
│  │    护眼模式，适配夜间     │  │
│  └───────────────────────────┘  │
│                                 │
│  ┌───────────────────────────┐  │
│  │       取消               │  │
│  └───────────────────────────┘  │
│                                 │
└─────────────────────────────────┘
```

### 3.3 切换动画效果

```
浅色 → 深色 切换动画（300ms）
┌─────────────────────────────────┐
│  背景色: #F0FDFA → #1A1A2E      │  ← 300ms 渐变
│  文字色: #0F172A → #F1F5F9     │
│  卡片: 轻微缩放 0.98 → 1.0     │  ← 100ms
└─────────────────────────────────┘
```

---

## 四、组件规范

### 4.1 卡片组件（深色模式）

```dart
// 浅色模式
Card(
  color: Color(0xFFFFFFFF),
  elevation: 0,
  shape: RoundedRectangleBorder(
    borderRadius: BorderRadius.circular(12),
  ),
)

// 深色模式
Card(
  color: Color(0xFF16213E),
  elevation: 0,
  shape: RoundedRectangleBorder(
    borderRadius: BorderRadius.circular(12),
    side: BorderSide(
      color: Color(0x1AFFFFFF), // 10% 白
    ),
  ),
)
```

### 4.2 毛玻璃组件（GlassCard）深色适配

> **评审补充**：项目核心容器是 `GlassCard`，深色模式下需要特殊处理。

| 元素 | 浅色模式 | 深色模式 |
|------|----------|----------|
| 背景色 | `rgba(255,255,255,0.80)` | `rgba(22,33,62,0.80)` |
| 边框色 | `rgba(255,255,255,0.40)` | `rgba(255,255,255,0.10)` |
| 模糊度 | 14px | 14px（保持一致） |
| 圆角 | 16px | 16px |

**实现要点**：
- 使用 `Theme.of(context).brightness` 动态判断当前主题
- 深色模式下边框变淡（避免过于刺眼）
- 背景色保持 80% 不透明度，确保内容可读

### 4.3 页面渐变背景深色适配

> **评审补充**：现有页面使用硬编码浅色渐变，需改为动态适配。

| 模式 | 背景渐变 |
|------|----------|
| 浅色 | `#E6FFFB` → `#F0FDFA` → `#FFF7ED` |
| 深色 | `#1A1A2E` → `#16213E` → `#1A1A2E` |

**实现要点**：
- 深色模式使用低饱和度渐变，避免视觉疲劳
- 中间色使用 `#16213E`（与卡片背景一致）
- 两端使用 `#1A1A2E`（与 scaffold 背景一致）

### 4.4 文字颜色使用规范

| 场景 | 浅色 | 深色 |
|------|------|------|
| 页面标题 | #0F172A | #F1F5F9 |
| 卡片标题 | #0F172A | #F1F5F9 |
| 正文内容 | #0F172A | #F1F5F9 |
| 次要信息 | #64748B | #94A3B8 |
| 禁用状态 | #94A3B8 | #64748B |

### 4.3 按钮样式

```dart
// 主按钮 - 浅色
ElevatedButton(
  style: ElevatedButton.styleFrom(
    backgroundColor: Color(0xFFF97316),
    foregroundColor: Colors.white,
  ),
)

// 主按钮 - 深色
ElevatedButton(
  style: ElevatedButton.styleFrom(
    backgroundColor: Color(0xFFF97316),
    foregroundColor: Colors.white,
    // 深色模式下增加一点发光效果
    elevation: 2,
  ),
)
```

---

## 五、跟随系统主题实现

### 5.1 流程图

```
┌─────────────────┐
│  用户进入设置   │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  点击主题模式   │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  选择跟随系统   │────┐
└────────┬────────┘    │
         │             ▼
         │    ┌─────────────────┐
         │    │  读取系统主题   │
         │    │  ThemeMode.system│
         │    └────────┬────────┘
         │             │
         │    ┌────────▼────────┐
         │    │  存储设置       │
         │    │  key: theme_mode│
         │    │  (加密 JSON)   │
         │    └────────┬────────┘
         │             │
         ▼             ▼
┌─────────────────┐
│  应用主题       │
│  MaterialApp    │
│  themeMode: _   │
└─────────────────┘
```

### 5.2 状态同步逻辑

| 系统主题 | 应用主题 | 场景 |
|----------|----------|------|
| Light | Light | 用户选择"跟随系统" |
| Dark | Dark | 用户选择"跟随系统" |
| - | Light | 用户选择"浅色" |
| - | Dark | 用户选择"深色" |

---

## 六、无障碍设计

### 6.1 对比度要求

| 元素 | 最小对比度 | 浅色值 | 深色值 |
|------|------------|--------|--------|
| 标题文字 | 4.5:1 | #0F172A | #F1F5F9 |
| 正文文字 | 4.5:1 | #0F172A | #F1F5F9 |
| 次要文字 | 4.5:1 | #64748B | #94A3B8 |
| 按钮文字 | 4.5:1 | #FFFFFF | #FFFFFF |

### 6.2 焦点状态

深色模式下交互元素需要可见的焦点指示器：

```dart
// 焦点边框
OutlineInputBorder(
  borderRadius: BorderRadius.circular(12),
  borderSide: BorderSide(
    color: Color(0xFF14B8A6), // 主色调
    width: 2,
  ),
)
```

---

## 七、第三方组件深色适配

> **评审补充**：统计页 `fl_chart` 和日历页 `table_calendar` 需要额外适配。

### 7.1 fl_chart（统计页图表）

| 元素 | 浅色模式 | 深色模式 |
|------|----------|----------|
| 图表背景 | `#FFFFFF` | `#16213E` |
| 网格线 | `#E2E8F0` | `rgba(255,255,255,0.10)` |
| 轴线文字 | `#0F172A` | `#F1F5F9` |
| 轴线标签 | `#64748B` | `#94A3B8` |
| 饼图文字 | `#0F172A` | `#F1F5F9` |
| Tooltip 背景 | `#FFFFFF` | `#1E293B` |
| Tooltip 文字 | `#0F172A` | `#F1F5F9` |

### 7.2 table_calendar（日历组件）

> **当前配置**：`outsideDaysVisible: false`，不展示非本月日期。

| 元素 | 浅色模式 | 深色模式 |
|------|----------|----------|
| 日历背景 | `#FFFFFF` | `#16213E` |
| header 背景 | `#F0FDFA` | `#1A1A2E` |
| header 文字 | `#0F172A` | `#F1F5F9` |
| 星期文字 | `#64748B` | `#94A3B8` |
| 日期文字 | `#0F172A` | `#F1F5F9` |
| 今日标记 | `#0D9488` 圆圈 | `#14B8A6` 圆圈 |
| 选中日期 | `#0D9488` 背景 | `#14B8A6` 背景 |

### 7.3 Material Icons 统一使用

> **评审补充**：UI/UX 文档线框使用 emoji 表意，实现时必须统一使用 Material Icons。

| 场景 | Material Icons |
|------|----------------|
| 导航 | `Icons.today`, `Icons.calendar_month`, `Icons.bar_chart`, `Icons.settings` |
| 操作 | `Icons.add`, `Icons.check`, `Icons.close`, `Icons.chevron_right` |
| 状态 | `Icons.error_outline`, `Icons.warning_amber`, `Icons.check_circle_outline` |

---

## 八、验收检查点

### 8.1 深色主题

- [ ] 首页在深色模式下显示正常，背景为 #1A1A2E
- [ ] 所有文字与背景对比度 ≥ 4.5:1
- [ ] 卡片背景为 #16213E，带有微弱边框
- [ ] 状态颜色（成功/警告/错误）清晰可辨
- [ ] 输入框在深色模式下可见且可交互
- [ ] **毛玻璃组件（GlassCard）** 深色下颜色/边框正确适配
- [ ] **页面渐变背景** 深色下使用低饱和度渐变

### 8.2 跟随系统

- [ ] 选择"跟随系统"后，切换手机系统主题，应用同步变化
- [ ] 切换延迟 < 500ms
- [ ] 系统主题变化时无白屏闪烁

### 8.3 主题设置

- [ ] 设置页显示"主题模式"入口
- [ ] 点击后弹出底部 Sheet
- [ ] 三个选项（跟随系统/浅色/深色）可选
- [ ] 选择后立即生效，无需重启
- [ ] 退出应用后再次进入，保持上次选择

### 8.4 动画效果

- [ ] 主题切换动画时长 300ms
- [ ] 无跳帧或卡顿
- [ ] 尊重系统"减少动态效果"设置

### 8.5 第三方组件

- [ ] **fl_chart 统计图表** 深色模式下轴线/网格/文字颜色正确
- [ ] **table_calendar 日历** 深色模式下选中态/今日标记正确
- [ ] 统计页饼图 tooltip 在深色下可读

### 8.6 图标规范

- [ ] 所有图标使用 Material Icons，无 emoji
- [ ] 底部导航图标与选中态颜色正确

### 8.7 字体一致性

- [ ] 不强制接入 Inter 字体，使用系统默认字体
- [ ] 全局字体统一（不混用多种字体家族）
